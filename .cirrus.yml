macos_instance:
  image: ghcr.io/cirruslabs/macos-ventura-xcode:14.2

task:
  environment:
    KEYCHAIN_PASSWORD: ENCRYPTED[!f759b51fea359a121eecc3a42f51f5708872a31d228060d9e87e5151ce8bb7d651994ddf87ed9a49a90ef9f2323c250a!]
    MATCH_KEYCHAIN_PASSWORD: ENCRYPTED[!f759b51fea359a121eecc3a42f51f5708872a31d228060d9e87e5151ce8bb7d651994ddf87ed9a49a90ef9f2323c250a!]
    APPSTORE_API_KEY_BASE64: ENCRYPTED[!6f25f56765b43025da8e5c5ddf2a4648fdc0bc15f31b759f8be2e8375a1bc37aaf51470739b66f7ca303d3adcad56e87!]
    MATCH_PASSWORD: ENCRYPTED[!544571b5760cc1c39cba8d6badbae6b6e0fc9c4450b69b1cb401bb0efe5457ea949c908f31bf9f238417b573229bd0df!]
    WIRE_INTERNAL_GITHUB_USER: ENCRYPTED[!c778f70560fcc248799ccffbb3f2f35efa95585ef4d80503f306242e88ea7382fb83165309da0a890415137015509f13!]
    WIRE_INTERNAL_GITHUB_TOKEN: ENCRYPTED[!b0498fdd0803950bd6ebe7d79bee994aa2b072e1cc0e36cd3a52511ead634100da7b6f5f8fd0e69940b4838ee70ab22b!]
    APPCENTER_API_TOKEN: ENCRYPTED[!fc7df3411be07fe076cffe5b05c44705922b1fa22a6929843e02e23163470b240b0ebfc1acf2162b394c522771d8da48!]
    APPCENTER_OWNER_NAME: ENCRYPTED[!a140f95b6fa0793a8a36e4816af3b08ad90aea96e3691ef7f0b83e271684ef87f2a97e389a15a4fc6e64577a0881d288!]
    S3_BUCKET: ENCRYPTED[!32dab388fb0d9053a83bbe525afff7b45d98b5be18a1d20bfa103c239b34776f6bf7bdc114a7429f5bb2d9f0c2eb9b09!]
    AWS_ACCESS_KEY_ID: ENCRYPTED[!d50256597be42f029587414a092a1d2ff1933ecf678cc65a07c60c66c12020986114819694bc01fffa34831a412e1233!]
    AWS_SECRET_ACCESS_KEY: ENCRYPTED[!251149139a9599c05539fb9de06fb76f80c5c5bbd08749d478df39ed26d6cdd7655df2808ab770e6d8825652a423a09e!]

  script:
  - brew install carthage
  - brew install ImageMagick
  - curl "https://awscli.amazonaws.com/AWSCLIV2.pkg" -o "AWSCLIV2.pkg"
  - sudo installer -pkg AWSCLIV2.pkg -target /
  - sh ./setup.sh
  - bundle exec fastlane ios prepare_for_release build_type:"AppStore" build_number:1234
  - bundle exec fastlane ios build_for_release build_type:"AppStore" build_number:1234
  # - bundle exec fastlane upload_app_center build_number:1234 build_type:"Playground"
  - bundle exec fastlane upload_app_center build_number:1234 build_type:"AppStore"
  # - bundle exec fastlane upload_s3 build_number:1234 build_type:"Playground"
