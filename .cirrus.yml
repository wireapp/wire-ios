macos_instance:
  image: ghcr.io/cirruslabs/macos-ventura-xcode:14.2

environment:
  KEYCHAIN_PASSWORD: ENCRYPTED[!f759b51fea359a121eecc3a42f51f5708872a31d228060d9e87e5151ce8bb7d651994ddf87ed9a49a90ef9f2323c250a!]
  MATCH_KEYCHAIN_PASSWORD: ENCRYPTED[!f759b51fea359a121eecc3a42f51f5708872a31d228060d9e87e5151ce8bb7d651994ddf87ed9a49a90ef9f2323c250a!]
  APPSTORE_API_KEY_BASE64: ENCRYPTED[!6f25f56765b43025da8e5c5ddf2a4648fdc0bc15f31b759f8be2e8375a1bc37aaf51470739b66f7ca303d3adcad56e87!]
  MATCH_PASSWORD: ENCRYPTED[!544571b5760cc1c39cba8d6badbae6b6e0fc9c4450b69b1cb401bb0efe5457ea949c908f31bf9f238417b573229bd0df!]
  WIRE_INTERNAL_GITHUB_USER: ENCRYPTED[!c778f70560fcc248799ccffbb3f2f35efa95585ef4d80503f306242e88ea7382fb83165309da0a890415137015509f13!]
  WIRE_INTERNAL_GITHUB_TOKEN: ENCRYPTED[!b0498fdd0803950bd6ebe7d79bee994aa2b072e1cc0e36cd3a52511ead634100da7b6f5f8fd0e69940b4838ee70ab22b!]
  APPCENTER_API_TOKEN: ENCRYPTED[!fc7df3411be07fe076cffe5b05c44705922b1fa22a6929843e02e23163470b240b0ebfc1acf2162b394c522771d8da48!]
  APPCENTER_OWNER_NAME: ENCRYPTED[!a140f95b6fa0793a8a36e4816af3b08ad90aea96e3691ef7f0b83e271684ef87f2a97e389a15a4fc6e64577a0881d288!]
  S3_BUCKET: ENCRYPTED[!32dab388fb0d9053a83bbe525afff7b45d98b5be18a1d20bfa103c239b34776f6bf7bdc114a7429f5bb2d9f0c2eb9b09!]
  AWS_ACCESS_KEY_ID: ENCRYPTED[!1f3053db6008e7154576c32190f1abf91cd33349127a7257c766176090c600ee064d27d55798ab116f1a71e3e9472c94!]
  AWS_SECRET_ACCESS_KEY: ENCRYPTED[!c219935c884288954c8c75de9f41dec0cfe6e6e5fceb543d832598ef0a9fe3dd97ea08b81e60ad9af3e68b6e20a9b44d!]
  DATADOG_API_KEY: ENCRYPTED[e00aded2ae71172ddc582023245a77852c387302fa1294a8ee926d71de0d7920925191d6e87c3c0fd5f83051a11b6cf1]

carthage_cache_template: &CARTHAGE_CACHE_TEMPLATE
  install_carthage:
    - which carthage || brew install carthage
  carthage_cache:
    folder: Carthage/Build
    fingerprint_script: cat Cartfile.resolved
    populate_script: 
      - carthage bootstrap --platform ios --use-xcframeworks

run_setup_script_template: &RUN_SETUP_SCRIPT_TEMPLATE
  bootstrap_ci_machine_script:
      - sh ./setup.sh

task:
  name: Build & Upload Playground Build
  trigger_type: manual
  << : *CARTHAGE_CACHE_TEMPLATE
  << : *RUN_SETUP_SCRIPT_TEMPLATE
  script:
    - bundle exec fastlane playground

task:
  name: Build & Upload AppStore Build
  trigger_type: manual
  << : *CARTHAGE_CACHE_TEMPLATE
  << : *RUN_SETUP_SCRIPT_TEMPLATE
  script:
    - bundle exec fastlane appstore_public
